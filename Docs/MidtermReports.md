# 中期报告

* 吴章昊
* 516030910593

## 编译器实现

1. 词法分析

    使用Antlr.v4，语法文件学习自C和Java的Antlr官方语法示例，并利用第4版Antlr的新特性LL(*)，去除冗余的层次结构，使结构更加简单、易于理解，对源代码进行词法分析，并生成CST。

2. 语义分析

    利用Antlr生成的CST访问者，遍历CST，使用Node基类节点搭建起AST，并为AST创建了一套带模板的访问者接口，使工程更加清晰、容易调试。在AST的基础上，进行语法检查，分为以下一些步骤：对变量定义，函数声明，类定义及类内变量定理、函数声明进行扫描，并添加到对应的符号表中，以实现前向引用；再对AST进行第二次顺序扫描，局部变量在扫描过程中，逐步添加至符号表中，从而避免变量先使用后定义的情况，同时进行类型检查，语句的类型通过visit函数返回值，返回到上一层，从而便于类型检查。

## 编译器特色

1. 编译参数

    使用Java的cli库，设置编译参数，包括-h[--help], -Wall, -i[--input], -o[--output], --print-ast等一系列参数，使编译器更便于使用

2. 编译错误提示

    编译器有详细彩色的编译器错误提示，不仅显示错误位置、原因，还会在错误信息中显示错误行的代码，并将错误的部分用红色标出。

3. 编译警告

    当-Wall选项开启时，输出函数缺乏返回值等编译警告（其他编译警告将在之后的IR优化环节创建）。

4. 工程管理

    使用类似于cmake的工程管理工具apache.maven，分发过程中可以不需要将依赖库，如antlr加入源代码中，而是利用项目中的pom.xml配置文件，让maven自动获取相关依赖，并编译（对online judge使用环境不适用）。

## 前期编译器经历

作为前几个完成语义分析的同学，学习antlr官方教程、虎书，并逐步搭出编译器架构的过程中，这是第一次没有完整的思路，在摸索中构建项目的经历。作为一个零基础的学生，这样的经历让我有了不少的成就感。虽然，目前学习LLVM的IR以及后续的优化仍然让我有些难以理清思路，但我很享受这样不断琢磨，将想法实现的过程，希望之后我的编译器能有些许成果。